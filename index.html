<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verdant - Cannabis Discovery Platform</title>
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
  <header id="header">
    <div class="header-content">
      <a href="index.html" class="logo">Verdant</a>
      <nav>
        <ul>
          <li><a href="learn.html">Learn</a></li>
          <li><a href="medical.html" class="medical-accent">Medical</a></li>
          <li><a href="recreational.html" class="recreational-accent">Recreational</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="hero-content">
        <h1>Discover Cannabis<br>with Clarity</h1>
        <p>Evidence-based product discovery for medical and recreational use.<br>Aggregated data, transparent sources, informed decisions.</p>
        
        <div class="search-container">
          <div class="search-bar">
            <input type="text" id="heroSearch" placeholder="Search by strain, effect, or condition...">
            <button onclick="performSearch()">Search</button>
          </div>
          <!-- Autosuggest dropdown will be inserted here -->
        </div>

        <div class="path-cards">
          <a href="learn.html" class="path-card">
            <div class="path-icon">ğŸ“š</div>
            <h3>Learn</h3>
            <p>Understand cannabinoids, consumption methods, safety guidelines, and everything you need to know before you start.</p>
          </a>

          <a href="medical.html" class="path-card medical">
            <div class="path-icon">âš•ï¸</div>
            <h3>Medical</h3>
            <p>CBD-focused products for therapeutic use. Research-backed data on treating conditions like chronic pain, anxiety, and inflammation.</p>
          </a>

          <a href="recreational.html" class="path-card recreational">
            <div class="path-icon">ğŸŒ¿</div>
            <h3>Recreational</h3>
            <p>THC products for personal enjoyment. Curated information on effects, potency, and user experiences from verified sources.</p>
          </a>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div class="text-center mb-xl">
          <h2>How Verdant Works</h2>
          <p style="margin: var(--space-md) auto;">We aggregate data from trusted sources so you don't have to.</p>
        </div>

        <div class="path-cards">
          <div class="info-card">
            <h3>ğŸ” Comprehensive Aggregation</h3>
            <p>We collect product information, reviews, and user experiences from Leafly, Weedmaps, Reddit communities, and other trusted platforms. All sources are cited and linked.</p>
          </div>

          <div class="info-card">
            <h3>ğŸ¯ Smart Filtering</h3>
            <p>Search by specific effects, medical conditions, THC/CBD ratios, consumption formats, and more. Find exactly what matches your needs.</p>
          </div>

          <div class="info-card">
            <h3>ğŸ“Š Transparent Data</h3>
            <p>See aggregated ratings, sentiment analysis, and direct links to original sources. Make informed decisions based on real experiences.</p>
          </div>
        </div>

        <div class="text-center mt-xl">
          <p style="color: var(--text-tertiary); font-size: 0.9rem;">
            Verdant is an informational platform. We do not sell products or provide medical advice.<br>
            Always consult healthcare professionals for medical guidance.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script src="js/main.js"></script>
  <script>
    let heroProducts = { medical: [], recreational: [] };

    // Load and setup hero search autosuggest
    async function initHeroSearch() {
      heroProducts = await window.verdant.loadProducts();
      const heroSearchInput = document.getElementById('heroSearch');

      heroSearchInput.addEventListener('input', (e) => {
        updateHeroAutosuggest(e.target);
      });

      heroSearchInput.addEventListener('focus', (e) => {
        if (e.target.value.length > 0) {
          updateHeroAutosuggest(e.target);
        }
      });

      heroSearchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          performSearch();
          closeAutosuggest(heroSearchInput);
        }
      });

      // Close autosuggest when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-container')) {
          closeAutosuggest(heroSearchInput);
        }
      });
    }

    // Update hero search autosuggest
    function updateHeroAutosuggest(searchInput) {
      const searchValue = searchInput.value.toLowerCase();
      let dropdown = document.getElementById('autosuggestDropdown');

      // Create dropdown if it doesn't exist
      if (!dropdown) {
        dropdown = document.createElement('div');
        dropdown.id = 'autosuggestDropdown';
        dropdown.className = 'autosuggest-dropdown';
        searchInput.closest('.search-container').appendChild(dropdown);
      }

      // Hide if search is empty
      if (searchValue.length === 0) {
        dropdown.classList.remove('active');
        return;
      }

      // Combine and filter products from both categories
      const allProducts = [...heroProducts.medical, ...heroProducts.recreational];
      const suggestions = allProducts.filter(product => {
        const name = product.name.toLowerCase();
        const type = product.type.toLowerCase();
        const effects = (product.effects || []).map(e => e.toLowerCase());
        const mood = (product.mood || []).map(m => m.toLowerCase());
        const conditions = (product.conditions || []).map(c => c.toLowerCase());
        const slang = (product.slang || []).map(s => s.toLowerCase());

        return (
          name.includes(searchValue) ||
          type.includes(searchValue) ||
          effects.some(e => e.includes(searchValue)) ||
          mood.some(m => m.includes(searchValue)) ||
          conditions.some(c => c.includes(searchValue)) ||
          slang.some(s => s.includes(searchValue))
        );
      }).slice(0, 8); // Limit to 8 suggestions

      // Render suggestions
      if (suggestions.length === 0) {
        dropdown.innerHTML = `<div class="autosuggest-no-results">No products found</div>`;
      } else {
        dropdown.innerHTML = suggestions.map(product => {
          const category = heroProducts.medical.some(p => p.id === product.id) ? 'medical' : 'recreational';
          return `
            <div class="autosuggest-item" onclick="selectHeroSuggestion('${product.name}', '${product.id}', '${category}')">
              <div class="autosuggest-item-icon">ğŸŒ¿</div>
              <div class="autosuggest-item-content">
                <div class="autosuggest-item-name">${product.name}</div>
                <div class="autosuggest-item-meta">${product.type}</div>
              </div>
            </div>
          `;
        }).join('');
      }

      dropdown.classList.add('active');
    }

    // Handle hero suggestion selection
    function selectHeroSuggestion(productName, productId, category) {
      const searchInput = document.getElementById('heroSearch');
      searchInput.value = productName;
      closeAutosuggest(searchInput);
      window.location.href = `product.html?id=${productId}&category=${category}`;
    }

    // Header scroll effect
    window.addEventListener('scroll', () => {
      const header = document.getElementById('header');
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });

    // Search functionality
    function performSearch() {
      const searchTerm = document.getElementById('heroSearch').value.toLowerCase();

      // Determine if search is more medical or recreational
      const medicalTerms = ['cbd', 'pain', 'anxiety', 'inflammation', 'medical', 'therapeutic', 'epilepsy'];
      const isMedical = medicalTerms.some(term => searchTerm.includes(term));

      // Redirect to appropriate page with search parameter
      const targetPage = isMedical ? 'medical.html' : 'recreational.html';
      window.location.href = `${targetPage}?q=${encodeURIComponent(searchTerm)}`;
    }

    // Allow Enter key to search
    document.getElementById('heroSearch').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        performSearch();
      }
    });

    // Initialize on page load
    initHeroSearch();
  </script>
</body>
</html>
